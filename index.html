<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Código de Participação</title>
  <script>
    function gerarCodigo() {
      const codigoExistente = localStorage.getItem("codigoParticipacao");

      if (codigoExistente) {
        document.getElementById("codigo").innerText = codigoExistente;
        console.log("Código existente recuperado do localStorage.");
        return; // Sai da função, não gera um novo código nem envia para o Sheets
      }

      const letras = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
      const numeros = "0123456789";
      let codigo = "";
      for (let i = 0; i < 2; i++) codigo += letras[Math.floor(Math.random() * letras.length)];
      for (let i = 0; i < 4; i++) codigo += numeros[Math.floor(Math.random() * numeros.length)];
      document.getElementById("codigo").innerText = codigo;

      // Armazena o código no localStorage
      localStorage.setItem("codigoParticipacao", codigo);
      console.log("Novo código gerado e armazenado no localStorage.");

      // Enviar para o Google Sheets
      fetch("https://script.google.com/macros/s/AKfycbxTPV1nsb5vOolJNxE2WStOBAGCp1zGJpICvv_FWAl2FMQPRQN1OTSYE8Ou6AGkByWN/exec", { 
        method: "POST",
        body: JSON.stringify({ codigo: codigo } ),
        headers: { "Content-Type": "text/plain;charset=utf-8" }, 
        redirect: "follow"
      }).then(response => {
        if (response.ok) {
            console.log("Código enviado com sucesso!");
            return response.json();
        } else {
            console.error("Erro na resposta do servidor:", response.status, response.statusText);
            return response.text().then(text => { throw new Error(text) });
        }
      }).catch(error => {
        console.error("Erro ao enviar código:", error);
      });
    }

    window.onload = gerarCodigo;
  </script>
</head>
<body>
  <h2>Obrigado por responder!</h2>
  <p>Seu código de participação é: <strong id="codigo"></strong></p>
  <p>Guarde este código para participar do sorteio.</p>
</body>
</html>
